<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <style>
        .centered {
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -200px;
            margin-left: -500px;
        }
    </style>
    <link type="text/css" rel="stylesheet" href="../assets/css/main.css" />
    <script src="../processing.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
</head>
<body >
<div id="cursor">+</div>
<h1>Dallas</h1>
<div class="centered"><canvas id="canvas1" width="400px" height="400px"></canvas></div>
<p id="results"></p>
    <p>Time Left: <span id="time"></span>s</p>
<!--<script src="assets/js/main.js"></script>-->
<script id="script1" type="text/javascript">
    
    var obj = document.getElementById('cursor').style;
    var cursorX = 0, cursorY = 0;
    //document.body.style.cursor="none";
    // Simple way to attach js code to the canvas is by using a function
    function sketchProc(p) {
        // Override draw function, by default it will be called 60 times per second
        p.size(1000, 400)
        p.textAlign(p.CENTER, p.CENTER);
        p.textSize(40);
        p.frameRate(30);
        var frames = 0;
        var maxFrames = 180;
        var blackY = [];
        var down = 7;
        var blackX = [];
        var score = 0;
        var errors = 0;
        var tolerances = 0;
        var fade = 10;
        var lose = false;
        var fadeIn = 0;
        var start = true;
        var f = p.createFont("Franklin Gothic Medium");
        var blackBool = [];
        var timeLeft = 30;
        var errTolX = 0,
            errTolY = 0;
        
        document.getElementById('time').innerHTML = timeLeft;
        setInterval(function(){
            if(start == false && lose != true && timeLeft > 0){
                timeLeft--;
                document.getElementById('time').innerHTML = timeLeft;
            }else if(timeLeft == 0){
                lose = true;
                return;
            }
        }, 1000);


        for (var i = 0; i < 4; i++) {
            blackX[i] = 300+ p.round(p.random(0, 3)) * 100;
            blackY[i] = (i - 1) * 400 / 3;
            blackBool[i] = false;
        }
        p.mousePressed = function() {
            if (start === false && lose === false) {
                for (var i = blackX.length-1; i >= 0 ; i--) {
                    if (cursorX > blackX[i] - errTolX && 
                        cursorX < blackX[i] + errTolX + 100 && 
                        cursorY > blackY[i] - errTolY && 
                        cursorY < blackY[i] + errTolY + 400 / 3 && 
                        blackBool[i] === false) {
                        blackBool[i] = true;
                        score++;
                        if (!(cursorX > blackX[i] && 
                            cursorX < blackX[i] + 100 && 
                            cursorY > blackY[i] && 
                            cursorY < blackY[i] + 400 / 3)) {
                            tolerances++;
                        }
                        break;
                    } else if (cursorX < blackX[i] && cursorY > blackY[i] && cursorY < blackY[i] + 400 / 3 ||
                        cursorX > blackX[i] + 100 && cursorY > blackY[i] && cursorY < blackY[i] + 400 / 3) {
                        errors++;
						score--;
                    }
                }


            }
            if (start === true) {
                if (cursorX > blackX[3] && cursorX < blackX[3] + 100 && cursorY > blackY[3] && cursorY < blackY[3] + 400 / 3) {
                    start = false;
                    blackBool[3] = true;
                    down = 7;
                }
            }
        };



        p.draw = function() {


            p.textFont(f);
            p.background(255);
            if (start === true) {
                down = 0;
            }
            if (lose === false && start === false && timeLeft > 20) {
                down += 0.01;

            }
            for (var i = 0; i < blackX.length; i++) {
                for (var j = 0; j < 4; j++) {
                    p.noFill();
                    p.strokeWeight(0.5);
                    p.stroke(125);
                    p.rect(300 + i * 100, 0 + blackY[j], 100, 400 / 3);
                }
                p.noStroke();
                if (blackBool[i] === true) {
                    p.fill(125);
                } else {
                    p.fill(0);
                }
                p.rect(blackX[i], blackY[i], 100, 400 / 3);
                blackY[i] += down;
                if (blackY[i] > 400) {
                    blackY[i] -= 400 * 4 / 3 - 1;
                    blackX[i] = 300 + p.round(p.random(0, 3)) * 100;
                    blackBool[i] = false;

                }
            }
            p.fill(255, 0, 0);
            p.textSize(40);
            //p.text(score, 200, 20);
            if (start === true) {
                p.fill(255, 0, 0);
                p.rect(blackX[3], blackY[3], 100, 400 / 3);
                p.textSize(24);
                p.fill(255);
                p.text("Start", blackX[3] + 50, blackY[3] + 400 / 6);
            }
            if (lose === true) {
                down = 0;
                p.fill(255, 0, 0, fadeIn);
                p.rect(300, 0, 400, 400);
                fadeIn += fade;
                if (fadeIn > 255) {
                    fade = 0;
                    p.fill(255);
                    p.textSize(50);
                    //p.text(score, 200, 150);
                    p.textSize(40);
                    //p.text("Play again", 200, 250);
                    document.getElementById('results').innerHTML = "Score: " + score + "<br>Errors: " + errors + "<br> Tolerances: " + tolerances;

                }
            }
        };

    }

    var canvas = document.getElementById("canvas1");
    // attaching the sketchProc function to the canvas
    var p = new Processing(canvas, sketchProc);
    // p.exit(); to detach it

    function getMouseCoords(e) {
        var e = e || window.event;
        document.getElementById('msg').innerHTML = e.clientX + ', ' +
            e.clientY + '<br>' + e.screenX + ', ' + e.screenY;
    }

    // Mouse gain adjustments.

    var divName = 'cursor'; // div that is to follow the mouse
    // (must be position:absolute)
    var offX = -17; // X offset from mouse position
    var offY = -30; // Y offset from mouse position

var last_position = {};
$(document).on('mousemove', function (event) {

    //check to make sure there is data to compare against
    if (typeof(last_position.x) != 'undefined') {

        //get the change from last position to this position
        var deltaX = last_position.x - event.clientX*0.75,
            deltaY = last_position.y - event.clientY*0.75;

        var vw = $(window).width();
        obj.left = event.pageX + deltaX*2 + offX - (vw/4) + 'px';
        obj.top = event.pageY + offY + 'px';
        cursorX = parseFloat(obj.left) - $('.centered').position().left + 500;
        cursorY = parseFloat(obj.top) - $('.centered').position().top + 200;
        console.log(deltaX, deltaY);
    }

    //set the new last position to the current for next time
    last_position = {
        x : event.clientX,
        y : event.clientY
    };
});

</script>
</body>

</html>

